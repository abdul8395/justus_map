<!DOCTYPE html>
<html>
<head>
    <title>Display a popup (dynamic map layer)</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" crossorigin=""></script>
    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

    <style>
      html,
      body,
      #map {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 14px;
        /* color: #323232; */
        color: rgb(255, 0, 0);
      }
      .legenddiv{
        padding: 30px 50px 30px 30px;
        width: 10%;
        height: 45vh;
        z-index: 99999;
        position: fixed;
        right: 0;
        bottom: 0;
      }
    </style>
   
</head>
<body>
<div id="map">
    <div id="legenddiv" style="z-index: 999999;">
        <img class="legenddiv" src="assets/img/va_legend_complete.png" alt="">
    </div>
</div>
</body>
</html>

<script>
  $('#legenddiv').css('visibility','hidden');
  var map

  var openstreet   = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

 
    map = L.map('map', {
    center: [27.839076094777816, -90.650390625],
    layers: [openstreet],
    zoom: 4,
    attributionControl: false
  });
  map.zoomControl.setPosition('bottomright');
  var googlestreet   = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
      maxZoom: 20,
      subdomains:['mt0','mt1','mt2','mt3']
      }).addTo(map)

//   var url='http://map3.urbanunit.gov.pk:6080/arcgis/rest/services/Punjab/BP_FoodSecurity_sugar_stockist_24032022/MapServer/2';

// ................Dynamic layer.........................  
    var dyn_url='http://map3.urbanunit.gov.pk:6080/arcgis/rest/services/Punjab/PB_space_tech_raster_dashboard_db73_v_12032021/MapServer';
    // var dyn_url='https://services3.arcgis.com/Ww6Zhg5FR2pLMf1C/arcgis/rest/services/VA_Electric_2016/FeatureServer';
    var dylyr=L.esri.dynamicMapLayer({
            url: dyn_url,
            opacity: 1,
            layers: [0]
        });
       
            dylyr.bindPopup(function (error, featureCollection) {
                if (error || featureCollection.features.length === 0) {
                return false;
                } else {
                    console.log(featureCollection.features[0].properties);
                // return "District: " + featureCollection.features[0].properties.district;
                }
            });
        

      
// ................feature layer.........................
// var furl='http://map3.urbanunit.gov.pk:6080/arcgis/rest/services/Punjab/PB_space_tech_raster_dashboard_db73_v_12032021/MapServer/2';
  var furl='https://services3.arcgis.com/Ww6Zhg5FR2pLMf1C/arcgis/rest/services/VA_Electric_2016/FeatureServer/0';
	
    //    var divi=L.esri.dynamicMapLayer({
       var flyr=L.esri.featureLayer({
                url: furl,
                opacity: 1,
                style: (feature) => {
                    let style = {
                        fillColor: "black",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                    };
                    if (feature.properties.Utility === "Appalachian Power Company") {
                        return {
                        fillColor: "#E08F94",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    // style.fillColor = "red";
                  
                    } 
                    else if (feature.properties.Utility === "Kentucky Utilities/Old Dominion Power Company") {
                        return {
                        fillColor: "#70AE8F",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Dominion Virginia Power") {
                        return {
                        fillColor: "yellow",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "A&N Electric Cooperative") {
                        return {
                        fillColor: "#F6C39F",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "BARC Electric Cooperative") {
                        return {
                        fillColor: "green",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Craig Botetourt Electric Cooperative") {
                        return {
                        fillColor: "#92E660",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Community Electric Cooperative") {
                        return {
                        fillColor: "#B4D3B2",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Central Virginia Electric Cooperative") {
                        return {
                        fillColor: "#74DBEF",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Mecklenburg Electric Cooperative") {
                        return {
                        fillColor: "#F9DAD3",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Northern Neck Electric Cooperative") {
                        return {
                        fillColor: "#F9EED5",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Northern Virginia Electric") {
                        return {
                        fillColor: "#C4B697",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Powell Valley Electric Cooperative") {
                        return {
                        fillColor: "#9C9D9A",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Prince George Electric Cooperative") {
                        return {
                        fillColor: "#6f03fc",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Rappahannock Electric Cooperative") {
                        return {
                        fillColor: "#C2E3E8",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Southside Electric Cooperative") {
                        return {
                        fillColor: "#EBE8E3",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 
                    else if (feature.properties.Utility === "Shenandoah Valley Electric Cooperative") {
                        return {
                        fillColor: "blue",
                        weight: 0.3,
                        opacity: 1,
                        color:"black",
                        dashArray: '2',
                        fillOpacity: 0.7
                        };
                    } 

                    else {
                    style.fillColor = "black";
                    }

                    return style;
                }
            });
        

        flyr.bindPopup(function (layer) {
            console.log(layer);
            // return L.Util.template("<b>District</b><br>{district_n}</br>", layer.feature.properties);
            // return L.Util.template('<b>Utility: </b>{Utility}<br><b>Phone: </b>{Phone}</br><b>Website: </b><a href="https://{Website}/" target="_blank">{Website}</a></br><b>Provider: </b>{Provider}</br><b>Provider_1: </b>{Provider_1}</br>', layer.feature.properties);
            return L.Util.template('<b>Utility: </b>{Utility}<br><b>Phone: </b>{Phone}</br><b>Website: </b>{Website}</br><b>Provider: </b>{Provider}</br><b>Provider_1: </b>{Provider_1}</br>', layer.feature.properties);
       
        });


 

var baseLayers = {
"openstreet": openstreet,
};

var overLays = {
"VA Electric Territories": flyr,
"Dynamic Layer": dylyr,
};

var mylayercontrol= L.control.layers(baseLayers,overLays).addTo(map);

map.on('overlayadd', function(e) {
    if(e.name=="VA Electric Territories"){
        // $('#legenddiv').show();
        setTimeout(function(){
        $('#legenddiv').css('visibility','visible');
        console.log('Changed to ' + e.name);
        }, 2000);
        
    }
    
});
map.on('overlayremove', function(e) {
    if(e.name=="VA Electric Territories"){
        $('#legenddiv').css('visibility','hidden');
        console.log('Changed to ' + e.name);
    }
});





</script>